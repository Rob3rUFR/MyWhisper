<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyWhisper - Transcription Audio</title>
    <link rel="stylesheet" href="/static/styles.css?v=12">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body x-data="sttApp()" x-init="init()">
    <!-- Background effects -->
    <div class="bg-grid"></div>
    <div class="bg-glow bg-glow-1"></div>
    <div class="bg-glow bg-glow-2"></div>
    
    <main class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <div class="logo-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/>
                        <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                        <line x1="12" x2="12" y1="19" y2="22"/>
                    </svg>
                </div>
                <h1>MyWhisper</h1>
            </div>
            <p class="subtitle">Transcription audio intelligente avec IA</p>
        </header>
        
        <!-- Tabs Navigation -->
        <div class="tabs-nav">
            <button class="tab-btn" :class="{ 'active': activeTab === 'file' }" @click="activeTab = 'file'">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"/>
                    <polyline points="13 2 13 9 20 9"/>
                </svg>
                Fichier
            </button>
            <button class="tab-btn" :class="{ 'active': activeTab === 'dictation' }" @click="activeTab = 'dictation'">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/>
                    <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                    <line x1="12" x2="12" y1="19" y2="22"/>
                </svg>
                Dict√©e
            </button>
            <button class="tab-btn" :class="{ 'active': activeTab === 'history' }" @click="activeTab = 'history'; loadHistory()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <polyline points="12 6 12 12 16 14"/>
                </svg>
                Historique
            </button>
            <button class="tab-btn" :class="{ 'active': activeTab === 'settings' }" @click="activeTab = 'settings'">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"/>
                    <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
                </svg>
                Param√®tres
            </button>
        </div>
        
        <!-- File Tab Content -->
        <div class="tab-content" x-show="activeTab === 'file'" x-transition>
        
        <!-- Upload Zone -->
        <div class="upload-section">
            <div class="dropzone" 
                 @drop.prevent="handleDrop($event)"
                 @dragover.prevent="dragActive = true"
                 @dragenter.prevent="dragActive = true"
                 @dragleave.prevent="dragActive = false"
                 :class="{ 'drag-active': dragActive, 'has-file': selectedFile || getFileDisplayInfo() }">
                
                <input type="file" 
                       id="fileInput" 
                       accept=".mp3,.wav,.m4a,.flac,.ogg,.webm,.mp4"
                       @change="handleFileSelect($event)"
                       hidden>
                
                <div class="dropzone-content" x-show="!selectedFile && !getFileDisplayInfo()">
                    <div class="dropzone-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"/>
                            <path d="M12 12v9"/>
                            <path d="m8 17 4-4 4 4"/>
                        </svg>
                    </div>
                    <label for="fileInput" class="dropzone-label">
                        <span class="dropzone-title">D√©posez votre fichier audio ici</span>
                        <span class="dropzone-hint">ou cliquez pour parcourir</span>
                    </label>
                    <div class="dropzone-formats">
                        MP3 ‚Ä¢ WAV ‚Ä¢ M4A ‚Ä¢ FLAC ‚Ä¢ OGG ‚Ä¢ WEBM
                    </div>
                </div>
                
                <div class="file-preview" x-show="selectedFile || getFileDisplayInfo()">
                    <div class="file-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M9 18V5l12-2v13"/>
                            <circle cx="6" cy="18" r="3"/>
                            <circle cx="18" cy="16" r="3"/>
                        </svg>
                    </div>
                    <div class="file-info">
                        <span class="file-name" x-text="getFileDisplayInfo()?.name"></span>
                        <span class="file-size" x-text="formatFileSize(getFileDisplayInfo()?.size)"></span>
                    </div>
                    <button class="file-remove" @click.stop="removeFile(); _restoredFileInfo = null">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Options Panel -->
        <div class="options-panel" :class="{ 'options-locked': processing }">
            <div class="option-group">
                <label class="option-label">
                    <span class="option-icon">üåç</span>
                    Langue
                </label>
                <select x-model="options.language" class="select-input" :disabled="processing">
                    <option value="">D√©tection automatique</option>
                    <option value="fr">Fran√ßais</option>
                    <option value="en">English</option>
                    <option value="es">Espa√±ol</option>
                    <option value="de">Deutsch</option>
                    <option value="it">Italiano</option>
                    <option value="pt">Portugu√™s</option>
                    <option value="nl">Nederlands</option>
                    <option value="pl">Polski</option>
                    <option value="ru">–†—É—Å—Å–∫–∏–π</option>
                    <option value="ja">Êó•Êú¨Ë™û</option>
                    <option value="zh">‰∏≠Êñá</option>
                    <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
                </select>
            </div>
            
            <div class="option-group">
                <label class="option-label">
                    <span class="option-icon">üìÑ</span>
                    Format
                </label>
                <select x-model="options.format" class="select-input" :disabled="processing">
                    <option value="json">JSON (complet)</option>
                    <option value="text">Texte brut</option>
                    <option value="srt">SRT (sous-titres)</option>
                    <option value="vtt">VTT (web)</option>
                </select>
            </div>
            
        </div>
        
        <!-- Server Busy Warning -->
        <div class="server-busy-warning" x-show="serverProcessing.is_processing && !processing" x-transition>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <line x1="12" y1="8" x2="12" y2="12"/>
                <line x1="12" y1="16" x2="12.01" y2="16"/>
            </svg>
            <span>
                Serveur occup√© : 
                <strong x-text="serverProcessing.processing_type === 'dictation' ? 'dict√©e' : 'fichier'"></strong>
                en cours de traitement
                (<span x-text="serverProcessing.current_file"></span>)
            </span>
        </div>
        
        <!-- Transcribe Button -->
        <button class="transcribe-btn" 
                @click="startTranscription()"
                :disabled="!selectedFile || processing || serverProcessing.is_processing"
                :class="{ 'processing': processing, 'blocked': serverProcessing.is_processing && !processing }">
            <span x-show="!processing" class="btn-content">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="5 3 19 12 5 21 5 3"/>
                </svg>
                <span x-text="serverProcessing.is_processing ? 'Serveur occup√©' : 'Transcrire'"></span>
            </span>
            <span x-show="processing" class="btn-content">
                <div class="spinner"></div>
                Traitement en cours...
            </span>
        </button>
        
        <!-- Progress Bar -->
        <div class="progress-container" x-show="processing" x-transition>
            <div class="progress-header">
                <div class="progress-status">
                    <div class="progress-spinner" x-show="!cancelRequested"></div>
                    <div class="cancel-spinner" x-show="cancelRequested"></div>
                    <span class="progress-status-text" x-text="statusText"></span>
                </div>
                <span class="progress-percent" x-text="`${progress}%`"></span>
            </div>
            <div class="progress-bar" :class="{ 'cancelling': cancelRequested }">
                <div class="progress-fill" :style="`width: ${progress}%`"></div>
                <div class="progress-glow" :style="`left: ${progress}%`"></div>
            </div>
            <div class="progress-steps">
                <div class="progress-step" :class="{ 'active': progress >= 0, 'done': progress > 25 }">
                    <div class="step-dot"></div>
                    <span>Envoi</span>
                </div>
                <div class="progress-step" :class="{ 'active': progress >= 25, 'done': progress > 85 }">
                    <div class="step-dot"></div>
                    <span>Transcription</span>
                </div>
                <div class="progress-step" :class="{ 'active': progress >= 85, 'done': progress >= 100 }">
                    <div class="step-dot"></div>
                    <span>Termin√©</span>
                </div>
            </div>
            
            <!-- Stop Button -->
            <button class="stop-btn" 
                    @click="cancelProcessing()"
                    :disabled="cancelRequested || progress >= 95"
                    :class="{ 'cancelling': cancelRequested }">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" x-show="!cancelRequested">
                    <rect x="6" y="6" width="12" height="12" rx="2"/>
                </svg>
                <div class="spinner-small" x-show="cancelRequested"></div>
                <span x-text="cancelRequested ? 'Annulation...' : 'Arr√™ter'"></span>
            </button>
        </div>
        
        <!-- Error Message -->
        <div class="error-message" x-show="error" x-transition>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <line x1="12" y1="8" x2="12" y2="12"/>
                <line x1="12" y1="16" x2="12.01" y2="16"/>
            </svg>
            <span x-text="error"></span>
            <button @click="error = null" class="error-close">√ó</button>
        </div>
        
        <!-- Results Section -->
        <div class="results-section" x-show="result" x-transition>
            <div class="results-header">
                <h2>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14 2 14 8 20 8"/>
                        <line x1="16" y1="13" x2="8" y2="13"/>
                        <line x1="16" y1="17" x2="8" y2="17"/>
                    </svg>
                    Transcription
                </h2>
                <div class="results-meta" x-show="resultMeta">
                    <span x-show="resultMeta?.language">
                        üåç <span x-text="getLanguageName(resultMeta?.language)"></span>
                    </span>
                    <span x-show="resultMeta?.duration">
                        ‚è±Ô∏è <span x-text="formatDuration(resultMeta?.duration)"></span>
                    </span>
                </div>
            </div>
            
            <div class="results-content">
                <pre x-text="result"></pre>
            </div>
            
            <div class="results-actions">
                <button class="action-btn primary" @click="downloadResult()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="7 10 12 15 17 10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                    T√©l√©charger
                </button>
                <button class="action-btn secondary" @click="copyToClipboard()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                    </svg>
                    <span x-text="copied ? 'Copi√© !' : 'Copier'"></span>
                </button>
                <button class="action-btn secondary" @click="clearResult()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="1 4 1 10 7 10"/>
                        <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/>
                    </svg>
                    Nouveau
                </button>
            </div>
            
            <!-- LLM Reprocessing Section -->
            <div class="llm-section" x-show="ollamaConnected && customPrompts.length > 0">
                <div class="llm-header">
                    <h4>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2a4 4 0 0 0-4 4v2H6a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2h-2V6a4 4 0 0 0-4-4z"/>
                        </svg>
                        Retraiter avec IA
                    </h4>
                    <span class="llm-model" x-text="ollamaSettings.model"></span>
                </div>
                <div class="llm-prompts">
                    <template x-for="(prompt, index) in customPrompts" :key="index">
                        <button class="llm-prompt-btn" 
                                @click="applyLLMPrompt(index)"
                                :disabled="llmProcessing"
                                x-text="prompt.name || 'Prompt ' + (index + 1)">
                        </button>
                    </template>
                </div>
                <div class="llm-status" x-show="llmProcessing">
                    <div class="spinner-small"></div>
                    <span>Traitement en cours...</span>
                </div>
                
                <!-- LLM Result -->
                <div class="llm-result" x-show="llmResult">
                    <div class="llm-result-header">
                        <span class="llm-result-title">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14 2 14 8 20 8"/>
                            </svg>
                            R√©sultat IA
                            <span class="llm-result-prompt" x-text="llmLastPrompt"></span>
                        </span>
                        <div class="llm-result-actions">
                            <button class="action-btn-small" @click="copyLLMResultFormatted()" title="Copier pour Word/Outlook">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                                </svg>
                                <span x-text="llmCopied ? 'Copi√© !' : 'Copier'"></span>
                            </button>
                            <button class="icon-btn" @click="clearLLMResult()" title="Fermer">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="18" y1="6" x2="6" y2="18"/>
                                    <line x1="6" y1="6" x2="18" y2="18"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="llm-result-content" id="llm-result-content" x-html="formatLLMResultForDisplay()"></div>
                </div>
            </div>
        </div>
        
        </div><!-- End File Tab Content -->
        
        <!-- Dictation Tab Content -->
        <div class="tab-content" x-show="activeTab === 'dictation'" x-transition>
            
            <!-- Frozen Overlay when file is processing -->
            <div class="frozen-overlay" x-show="processing || (serverProcessing.is_processing && serverProcessing.processing_type === 'file')" x-transition>
                <div class="frozen-content">
                    <div class="frozen-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                            <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                        </svg>
                    </div>
                    <h3>Dict√©e indisponible</h3>
                    <p>Un fichier est en cours de transcription</p>
                    <div class="frozen-file">
                        <span x-text="serverProcessing.current_file || selectedFile?.name"></span>
                    </div>
                    <div class="frozen-progress">
                        <div class="frozen-spinner"></div>
                        <span>Veuillez patienter...</span>
                    </div>
                </div>
            </div>
            
            <!-- Recording Controls -->
            <div class="dictation-section" :class="{ 'frozen': processing || (serverProcessing.is_processing && serverProcessing.processing_type === 'file') }">
                <div class="recording-status" :class="{ 'recording': isRecording }">
                    <div class="recording-indicator">
                        <div class="pulse-ring" x-show="isRecording"></div>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/>
                            <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                            <line x1="12" x2="12" y1="19" y2="22"/>
                        </svg>
                    </div>
                    <div class="recording-info">
                        <span class="recording-label" x-text="isRecording ? 'Enregistrement en cours...' : 'Pr√™t √† enregistrer'"></span>
                        <span class="recording-time" x-show="isRecording" x-text="formatRecordingTime(recordingTime)"></span>
                        <div class="silence-indicator" x-show="isRecording && silenceDuration > 2">
                            <span class="silence-warning">Silence d√©tect√©...</span>
                            <span class="silence-countdown" x-text="`Arr√™t auto dans ${Math.ceil(dictationOptions.silenceTimeout - silenceDuration)}s`"></span>
                        </div>
                    </div>
                </div>
                
                <!-- Audio Level Meter -->
                <div class="audio-meter" x-show="isRecording">
                    <div class="audio-meter-fill" :style="`width: ${Math.min(audioLevel * 300, 100)}%`"></div>
                </div>
                
                <button class="record-btn" 
                        :class="{ 'recording': isRecording, 'processing': dictationProcessing, 'blocked': serverProcessing.is_processing && serverProcessing.processing_type !== 'dictation' && !isRecording }"
                        @click="toggleRecording()"
                        :disabled="dictationProcessing || (serverProcessing.is_processing && serverProcessing.processing_type !== 'dictation' && !isRecording)">
                    <span x-show="!isRecording && !dictationProcessing && !(serverProcessing.is_processing && serverProcessing.processing_type !== 'dictation')" class="btn-content">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <circle cx="12" cy="12" r="10"/>
                        </svg>
                        D√©marrer
                    </span>
                    <span x-show="!isRecording && !dictationProcessing && serverProcessing.is_processing && serverProcessing.processing_type !== 'dictation'" class="btn-content">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/>
                        </svg>
                        Serveur occup√©
                    </span>
                    <span x-show="isRecording" class="btn-content">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <rect x="6" y="6" width="12" height="12" rx="2"/>
                        </svg>
                        Arr√™ter
                    </span>
                    <span x-show="dictationProcessing" class="btn-content">
                        <div class="spinner"></div>
                        Traitement...
                    </span>
                </button>
                
                <!-- Dictation Options -->
                <div class="dictation-options">
                    <div class="option-group">
                        <label class="option-label">
                            <span class="option-icon">üåç</span>
                            Langue
                        </label>
                        <select x-model="dictationOptions.language" class="select-input">
                            <option value="">D√©tection automatique</option>
                            <option value="fr">Fran√ßais</option>
                            <option value="en">English</option>
                            <option value="es">Espa√±ol</option>
                            <option value="de">Deutsch</option>
                            <option value="it">Italiano</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- Dictation Result -->
            <div class="dictation-result" x-show="dictationText || isRecording" :class="{ 'frozen': processing || (serverProcessing.is_processing && serverProcessing.processing_type === 'file') }">
                <div class="dictation-result-header">
                    <h3>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                        </svg>
                        Transcription
                        <span class="live-badge" x-show="isRecording">EN DIRECT</span>
                    </h3>
                    <div class="dictation-actions-mini">
                        <button class="icon-btn" @click="copyDictation()" title="Copier" :disabled="!dictationText">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                            </svg>
                        </button>
                        <button class="icon-btn" @click="clearDictation()" title="Effacer" :disabled="!dictationText">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="3 6 5 6 21 6"/>
                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="dictation-text-area">
                    <p>
                        <span x-text="dictationText"></span>
                        <span class="typing-indicator" x-show="dictationProcessing">
                            <span></span><span></span><span></span>
                        </span>
                    </p>
                    <p class="dictation-placeholder" x-show="!dictationText && isRecording">
                        Parlez, la transcription appara√Ætra ici...
                    </p>
                </div>
            </div>
            
            <!-- Dictation Error -->
            <div class="error-message" x-show="dictationError" x-transition>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="12" y1="8" x2="12" y2="12"/>
                    <line x1="12" y1="16" x2="12.01" y2="16"/>
                </svg>
                <span x-text="dictationError"></span>
                <button @click="dictationError = null" class="error-close">√ó</button>
            </div>
            
        </div><!-- End Dictation Tab Content -->
        
        <!-- History Tab Content -->
        <div class="tab-content" x-show="activeTab === 'history'" x-transition>
            
            <div class="history-section">
                <div class="history-header">
                    <h3>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <polyline points="12 6 12 12 16 14"/>
                        </svg>
                        Historique des transcriptions
                    </h3>
                    <span class="history-info" x-show="historyTotal > 0">
                        <span x-text="historyTotal"></span> transcription(s) ‚Ä¢ <span x-text="retentionDays"></span> jours
                    </span>
                </div>
                
                <!-- Loading state -->
                <div class="history-loading" x-show="historyLoading">
                    <div class="spinner"></div>
                    <span>Chargement...</span>
                </div>
                
                <!-- Empty state -->
                <div class="history-empty" x-show="!historyLoading && historyItems.length === 0">
                    <div class="history-empty-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                            <line x1="12" y1="18" x2="12" y2="12"/>
                            <line x1="9" y1="15" x2="15" y2="15"/>
                        </svg>
                    </div>
                    <p>Aucune transcription dans l'historique</p>
                    <span>Les transcriptions de fichiers seront conserv√©es ici pendant <span x-text="retentionDays"></span> jours</span>
                </div>
                
                <!-- History list -->
                <div class="history-list" x-show="!historyLoading && historyItems.length > 0">
                    <template x-for="item in historyItems" :key="item.id">
                        <div class="history-item">
                            <div class="history-item-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M9 18V5l12-2v13"/>
                                    <circle cx="6" cy="18" r="3"/>
                                    <circle cx="18" cy="16" r="3"/>
                                </svg>
                            </div>
                            <div class="history-item-info">
                                <span class="history-item-name" x-text="item.filename"></span>
                                <div class="history-item-meta">
                                    <span x-text="formatHistoryDate(item.created_at)"></span>
                                    <span>‚Ä¢</span>
                                    <span x-text="formatDuration(item.audio_duration)"></span>
                                    <span>‚Ä¢</span>
                                    <span x-text="getLanguageName(item.language)"></span>
                                    <span x-show="item.processing_duration">‚Ä¢ ‚ö° <span x-text="formatProcessingDuration(item.processing_duration)"></span></span>
                                </div>
                            </div>
                            <div class="history-item-actions">
                                <select class="history-format-select" x-model="item.downloadFormat">
                                    <option value="text">Texte</option>
                                    <option value="json">JSON</option>
                                    <option value="srt">SRT</option>
                                    <option value="vtt">VTT</option>
                                </select>
                                <button class="action-btn primary small" @click="downloadHistoryItem(item)" title="T√©l√©charger">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                        <polyline points="7 10 12 15 17 10"/>
                                        <line x1="12" y1="15" x2="12" y2="3"/>
                                    </svg>
                                </button>
                                <button class="action-btn secondary small" @click="viewHistoryItem(item)" title="Voir">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                        <circle cx="12" cy="12" r="3"/>
                                    </svg>
                                </button>
                                <button class="action-btn danger small" @click="deleteHistoryItem(item)" title="Supprimer">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="3 6 5 6 21 6"/>
                                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </template>
                </div>
                
                <!-- Pagination -->
                <div class="history-pagination" x-show="historyTotal > historyLimit">
                    <button class="pagination-btn" 
                            @click="loadHistory(historyOffset - historyLimit)"
                            :disabled="historyOffset === 0">
                        ‚Üê Pr√©c√©dent
                    </button>
                    <span class="pagination-info">
                        <span x-text="historyOffset + 1"></span> - <span x-text="Math.min(historyOffset + historyLimit, historyTotal)"></span>
                        sur <span x-text="historyTotal"></span>
                    </span>
                    <button class="pagination-btn"
                            @click="loadHistory(historyOffset + historyLimit)"
                            :disabled="historyOffset + historyLimit >= historyTotal">
                        Suivant ‚Üí
                    </button>
                </div>
            </div>
            
            <!-- History Detail Modal -->
            <div class="history-modal" x-show="historyViewItem" x-transition @click.self="historyViewItem = null">
                <div class="history-modal-content">
                    <div class="history-modal-header">
                        <h4 x-text="historyViewItem?.filename"></h4>
                        <button class="icon-btn" @click="historyViewItem = null">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="18" y1="6" x2="6" y2="18"/>
                                <line x1="6" y1="6" x2="18" y2="18"/>
                            </svg>
                        </button>
                    </div>
                    <div class="history-modal-meta">
                        <span x-text="formatHistoryDate(historyViewItem?.created_at)"></span>
                        <span>‚Ä¢</span>
                        <span x-text="formatDuration(historyViewItem?.audio_duration)"></span>
                        <span>‚Ä¢</span>
                        <span x-text="historyViewItem?.segments_count + ' segments'"></span>
                    </div>
                    <div class="history-modal-body">
                        <pre x-text="historyViewItem?.result_text"></pre>
                    </div>
                    <div class="history-modal-actions">
                        <button class="action-btn primary" @click="copyHistoryItem(historyViewItem)">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                            </svg>
                            Copier
                        </button>
                        <button class="action-btn secondary" @click="historyViewItem = null">
                            Fermer
                        </button>
                    </div>
                </div>
            </div>
            
        </div><!-- End History Tab Content -->
        
        <!-- Settings Tab Content -->
        <div class="tab-content" x-show="activeTab === 'settings'" x-transition>
            
            <div class="settings-section">
                <h3 class="settings-title">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <polyline points="12 6 12 12 16 14"/>
                    </svg>
                    Historique
                </h3>
                
                <div class="settings-group">
                    <label class="settings-label">Dur√©e de conservation (jours)</label>
                    <div class="retention-input-row">
                        <input type="number" 
                               x-model="retentionDays" 
                               class="number-input retention-input"
                               min="1" 
                               max="365"
                               placeholder="90">
                        <button class="settings-btn" @click="saveRetentionDays()" :disabled="retentionLoading">
                            <span x-show="!retentionLoading">Appliquer</span>
                            <span x-show="retentionLoading" class="spinner-small"></span>
                        </button>
                    </div>
                    <span class="option-hint">Les transcriptions plus anciennes seront automatiquement supprim√©es (1-365 jours)</span>
                </div>
            </div>
            
            <div class="settings-section">
                <h3 class="settings-title">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
                    </svg>
                    Configuration Ollama
                </h3>
                
                <div class="settings-group">
                    <div class="settings-info" x-show="!ollamaConfigured">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="12" y1="16" x2="12" y2="12"/>
                            <line x1="12" y1="8" x2="12.01" y2="8"/>
                        </svg>
                        <span>Ollama n'est pas configur√©. Ajoutez <code>OLLAMA_URL</code> dans le fichier <code>.env</code></span>
                    </div>
                    <div class="settings-status-row" x-show="ollamaConfigured">
                        <div class="settings-status">
                            <span :class="ollamaConnected ? 'status-success' : 'status-error'" x-text="ollamaStatus"></span>
                        </div>
                        <button class="settings-btn" @click="checkOllamaStatus()" :disabled="ollamaLoading">
                            <span x-show="!ollamaLoading">Actualiser</span>
                            <span x-show="ollamaLoading" class="spinner-small"></span>
                        </button>
                    </div>
                </div>
                
                <div class="settings-group" x-show="ollamaConnected">
                    <label class="settings-label">Mod√®le LLM</label>
                    <select x-model="ollamaSettings.model" class="select-input">
                        <option value="">-- S√©lectionner un mod√®le --</option>
                        <template x-for="model in ollamaModels" :key="model">
                            <option :value="model" x-text="model"></option>
                        </template>
                    </select>
                </div>
            </div>
            
            <div class="settings-section">
                <h3 class="settings-title">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                    </svg>
                    Prompts de retraitement
                </h3>
                
                <div class="prompts-list">
                    <template x-for="(prompt, index) in customPrompts" :key="index">
                        <div class="prompt-item">
                            <div class="prompt-header">
                                <input type="text" 
                                       x-model="prompt.name" 
                                       class="prompt-name-input"
                                       placeholder="Nom du prompt">
                                <button class="icon-btn danger" @click="removePrompt(index)" title="Supprimer">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="3 6 5 6 21 6"/>
                                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                    </svg>
                                </button>
                            </div>
                            <textarea x-model="prompt.content" 
                                      class="prompt-textarea"
                                      placeholder="Entrez votre prompt ici... Utilisez {text} pour ins√©rer la transcription."
                                      rows="3"></textarea>
                        </div>
                    </template>
                </div>
                
                <button class="add-prompt-btn" @click="addPrompt()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"/>
                        <line x1="5" y1="12" x2="19" y2="12"/>
                    </svg>
                    Ajouter un prompt
                </button>
                
                <button class="save-settings-btn" @click="saveSettings()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                        <polyline points="17 21 17 13 7 13 7 21"/>
                        <polyline points="7 3 7 8 15 8"/>
                    </svg>
                    Sauvegarder les param√®tres
                </button>
            </div>
            
        </div><!-- End Settings Tab Content -->
        
        <!-- Footer -->
        <footer class="footer">
            <p>Propuls√© par <strong>Faster Whisper Large v3</strong></p>
        </footer>
    </main>
    
    <script src="/static/app.js?v=16"></script>
</body>
</html>
